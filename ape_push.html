<!doctype html>
<html>
    <head>
        <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="http://cdn.sockjs.org/sockjs-0.3.min.js"></script>
        <link href="style.css" rel="stylesheet">

    </head>
    <body lang="en">

        <h3>TURTED Server Push example</h3>
        <p>The purpose of this demo is to show how a data package can be created and pushed to the server via HTTP GET. The same approach could be used by any client or server to send a package for dispatch</p>
        APE style
        <form id="apeinlinepush" action="?#">
            Cmd: <select name="pushcmd" id="pushcmd">
            <option value="notifyUser">notifyUser</option>
            <option value="notifyChannel">notifyChannel</option>
            <option value="notifyAll">notifyAll</option>
        </select><br />
            Event: <input type="text" id="event" placeholder="event type" value="message"><br>
            Target: <input type="text" id="target" placeholder="user or channel" value="xosofox"><br />
            Passwd: <input type="text" id="pushpasswd" value="IamAllowed2PUSH!!!"><br />
            Payload <br />
            <input type="text" id="payload" value="Data to deliver"><br />

            <input type="text" id="baseUrl" value="http://localhost/push/?" name="baseUrl" />
            <input type="text" id="pushUrl" style="width: 300px; font-size: 8pt" value="-">
            <br />
            <input type="button" value="Push" id="pushit">
        </form>

        <script type="text/javascript">
            function rebuildApeCmd() {
                var pushcmd = $('#pushcmd').val();
                var password = $('#pushpasswd').val();
                var event = $('#event').val();
                var targetlist = $('#target').val();
                var data = $('#payload').val();

                return [
                    {
                        "cmd": pushcmd,
                        "params": {
                            "password": password,
                            "event": event,
                            "channel": targetlist,
                            "user": targetlist,
                            "data": data
                        }
                    }
                ];
            }

            function rebuildAll() {
                var apecmd = rebuildApeCmd();
                var baseUrl = $('#baseUrl').val();
                //console.log(apecmd);
                $('#pushUrl').val(baseUrl + apeEncode(apecmd));
            }

            function apeEncode(cmd) {
                return encodeURIComponent(JSON.stringify(cmd));
            }

            $('#apeinlinepush').on("keyup change", "input,select", rebuildAll);
            $('#pushit').on("click", function () {
                rebuildAll();
                var url = $('#pushUrl').val();
                console.log(url);
                $.get(url, function (a, b, c, d) {
                    console.log(a);
                    console.log(b);
                    console.log(c);
                    console.log(d);
                });
            })

        </script>

    </body>
</html>
